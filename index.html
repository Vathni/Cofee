<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bean & Brew Â· coffee beans & tea</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome 6 (free) for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      /* Optimized transitions for smooth performance */
      * {
        -webkit-tap-highlight-color: transparent;
      }

      .menu-card {
        transition:
          transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
          box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, box-shadow;
        backface-visibility: hidden;
      }
      .menu-card:hover {
        transform: translateY(-4px);
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 8px 10px -6px rgba(0, 0, 0, 0.02);
      }
      .menu-card:active {
        transform: translateY(-2px);
      }

      .cart-badge {
        transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
      }
      .cart-badge-update {
        transform: scale(1.2);
      }

      .btn-primary {
        transition:
          background-color 0.15s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, background-color;
        backface-visibility: hidden;
      }
      .btn-primary:active {
        transform: scale(0.97);
      }

      .payment-method {
        transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: border-color, background-color;
        cursor: pointer;
      }
      .payment-method.selected {
        border-color: #b45309;
        background-color: #fffbeb;
      }

      .khqr-card {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        border-radius: 1rem;
        padding: 1.5rem;
        color: white;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      }

      .khqr-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
      }

      .khqr-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        position: relative;
        z-index: 1;
      }

      .khqr-title {
        font-size: 1.5rem;
        font-weight: bold;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .khqr-subtitle {
        font-size: 0.8rem;
        opacity: 0.9;
        letter-spacing: 1px;
      }

      .khqr-merchant {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.5rem;
        border-radius: 0.5rem;
        margin: 1rem 0;
        text-align: center;
        font-family: monospace;
        font-size: 1.1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .khqr-amount {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 1rem 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .khqr-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.7rem;
        opacity: 0.8;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 1rem;
        margin-top: 1rem;
      }

      .khqr-badge {
        background: #ffd700;
        color: #1e3c72;
        padding: 0.25rem 0.75rem;
        border-radius: 2rem;
        font-weight: bold;
        font-size: 0.8rem;
      }

      .qr-container {
        background: white;
        padding: 1rem;
        border-radius: 1rem;
        display: inline-block;
        margin: 1rem auto;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
      }

      .qr-image {
        width: 400px;
        height: 400px;
        object-fit: contain;
        image-rendering: pixelated;
      }

      .video-banner {
        position: relative;
        width: 100%;
        height: 300px;
        overflow: hidden;
        will-change: transform;
      }
      .video-banner video {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-width: 100%;
        min-height: 100%;
        object-fit: cover;
        filter: brightness(0.7);
        will-change: transform;
      }
      .banner-content {
        position: relative;
        z-index: 5;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .product-image {
        width: 100%;
        height: 320px;
        object-fit: cover;
        border-radius: 0.75rem 0.75rem 0 0;
        will-change: transform;
        backface-visibility: hidden;
      }
      .discount-code {
        background: linear-gradient(135deg, #fbbf24 0%, #b45309 100%);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform, box-shadow;
      }
      .discount-code:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 15px -3px rgba(180, 83, 9, 0.3);
      }

      .social-icon {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
        backface-visibility: hidden;
      }
      .social-icon:hover {
        transform: translateY(-3px);
      }

      /* Smooth modal transitions */
      .modal-transition {
        transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: opacity;
      }

      #cartSidebar {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: transform;
      }

      #overlay {
        transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: opacity;
      }

      .success-popup {
        animation: slideInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        will-change: transform, opacity;
        backface-visibility: hidden;
      }
      @keyframes slideInUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      html {
        scroll-behavior: smooth;
      }
      button,
      a,
      .cursor-pointer {
        touch-action: manipulation;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        ring: 2px solid #f59e0b;
        border-color: #f59e0b;
      }

      /* Invoice card (the new modal) */
      .invoice-card {
        transition: all 0.2s ease;
      }
      .copy-btn:active {
        transform: scale(0.96);
      }
      @media print {
        .no-print {
          display: none;
        }
        body {
          background: white;
        }
        .invoice-card {
          box-shadow: none;
          border: 1px solid #e5e7eb;
        }
      }

      /* Voucher card in invoice */
      .voucher-card {
        background: linear-gradient(145deg, #fef3c7, #fde68a);
        border-left: 6px solid #b45309;
      }
    </style>
  </head>
  <body class="bg-amber-50 font-sans antialiased flex flex-col min-h-screen">
    <!-- ========== VIDEO BANNER ========== -->
    <div class="video-banner">
      <video
        autoplay
        muted
        loop
        playsinline
        preload="auto"
        poster="https://images.unsplash.com/photo-1442512595331-e89e73853f31?w=1200&auto=format"
      >
        <source src="./209424_tiny.mp4" type="video/mp4" />
      </video>
      <div class="absolute inset-0 flex items-center justify-center banner-content">
        <div class="text-center">
          <h1 class="text-4xl md:text-6xl font-bold mb-2">Bean & Brew</h1>
          <p class="text-xl md:text-2xl font-light">premium coffee beans Â· loose leaf tea</p>
          <div class="mt-4 flex gap-3 justify-center">
            <span
              class="bg-amber-600/80 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold"
              >fresh roasted</span
            >
            <span
              class="bg-amber-700/80 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold"
              ><i class="fa-regular fa-star mr-1"></i>worldwide shipping</span
            >
          </div>
        </div>
      </div>
    </div>

    <!-- ========== HEADER with cart & orders ========== -->
    <header
      class="bg-white/90 backdrop-blur-sm shadow-sm border-b border-amber-200 sticky top-0 z-10"
    >
      <div
        class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between flex-wrap gap-y-2"
      >
        <div class="flex items-center gap-3">
          <i class="fa-solid fa-mug-hot text-3xl text-amber-700"></i>
          <h1 class="text-2xl font-bold tracking-tight text-stone-800">
            Bean & <span class="text-amber-700">Brew</span>
          </h1>
        </div>

        <div class="flex items-center gap-4">
          <!-- Discount Code Display (visible when available) -->
          <div id="headerDiscountBadge" class="hidden relative">
            <button
              onclick="window.openDiscountModal()"
              class="bg-gradient-to-r from-amber-600 to-amber-800 text-white px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-2 cursor-pointer transition-transform hover:scale-105 active:scale-95"
            >
              <i class="fa-solid fa-tag"></i>
              <span id="headerDiscountCode">WELCOME5</span>
              <i class="fa-regular fa-copy text-xs"></i>
            </button>
          </div>
          <!-- My Orders Button -->
          <button
            id="myOrdersBtn"
            class="flex items-center gap-2 bg-white border border-amber-300 hover:bg-amber-50 px-4 py-2 rounded-full transition-all duration-200 hover:scale-105 active:scale-95"
          >
            <i class="fa-solid fa-clipboard-list text-amber-700"></i>
            <span class="hidden sm:inline text-stone-700">my orders</span>
          </button>
          <!-- Cart button -->
          <button
            id="cartToggleBtn"
            class="relative flex items-center gap-2 bg-amber-100 hover:bg-amber-200 px-4 py-2 rounded-full transition-all duration-200 hover:scale-105 active:scale-95 group"
          >
            <i class="fa-solid fa-cart-shopping text-amber-800 text-lg"></i>
            <span
              id="cartCount"
              class="bg-amber-800 text-white text-xs font-bold px-2 py-0.5 rounded-full cart-badge"
              >0</span
            >
            <span id="cartTotalDisplay" class="font-semibold text-stone-800 ml-1">$0.00</span>
          </button>
        </div>
      </div>
      <!-- Quick nav links -->
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-2 flex gap-6 text-sm">
        <a
          href="#products"
          class="text-stone-600 hover:text-amber-700 transition-colors duration-200 flex items-center gap-1 py-1"
          ><i class="fa-solid fa-leaf mr-1"></i>Products</a
        >
        <a
          href="#about"
          class="text-stone-600 hover:text-amber-700 transition-colors duration-200 flex items-center gap-1 py-1"
          ><i class="fa-regular fa-heart mr-1"></i>About</a
        >
        <a
          href="#contact"
          class="text-stone-600 hover:text-amber-700 transition-colors duration-200 flex items-center gap-1 py-1"
          ><i class="fa-regular fa-envelope mr-1"></i>Contact</a
        >
      </div>
    </header>

    <!-- ========== SUCCESS POPUP NOTIFICATION ========== -->
    <div
      id="successPopup"
      class="fixed bottom-6 right-6 z-50 transform translate-x-full opacity-0 transition-all duration-300 hidden"
    >
      <div
        class="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl shadow-2xl p-6 max-w-sm success-popup relative overflow-hidden"
      >
        <div class="popup-confetti" id="confetti">ðŸŽ‰ âœ¨ ðŸŽŠ ðŸŽˆ</div>
        <div class="flex items-start gap-4">
          <div class="bg-white/20 rounded-full p-3 backdrop-blur-sm">
            <i class="fa-solid fa-circle-check text-3xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-xl mb-1">Order Successful! ðŸŽ‰</h4>
            <p id="popupMessage" class="text-white/90 text-sm mb-3">
              Your order has been placed successfully.
            </p>
            <div class="flex gap-2">
              <button
                onclick="
                  window.closeSuccessPopup();
                  window.openInvoiceModal();
                "
                class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold transition-all duration-200 hover:scale-105 active:scale-95 flex items-center gap-1"
              >
                <i class="fa-regular fa-file-lines"></i> view invoice
              </button>
              <button
                onclick="window.closeSuccessPopup()"
                class="bg-white/20 hover:bg-white/30 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-semibold transition-all duration-200 hover:scale-105 active:scale-95"
              >
                close
              </button>
            </div>
          </div>
          <button
            onclick="window.closeSuccessPopup()"
            class="text-white/60 hover:text-white transition-colors"
          >
            <i class="fa-solid fa-xmark text-xl"></i>
          </button>
        </div>
        <!-- Progress bar for auto-close -->
        <div class="absolute bottom-0 left-0 h-1 bg-white/30 w-full">
          <div
            id="popupProgress"
            class="h-full bg-white rounded-r-full"
            style="width: 100%; transition: width 5s linear"
          ></div>
        </div>
      </div>
    </div>

    <!-- ========== DISCOUNT CODE MODAL (for showing code from invoice) ========== -->
    <div
      id="discountModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden modal-transition"
    >
      <div
        class="bg-white rounded-2xl max-w-md w-full mx-4 p-6 shadow-2xl relative border border-amber-200 transform transition-all duration-200 scale-95 opacity-0"
        id="discountModalContent"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-stone-800 flex items-center gap-2">
            <i class="fa-solid fa-tag text-amber-700"></i> Your 5% Discount Code
          </h3>
          <button
            onclick="window.closeDiscountModal()"
            class="text-stone-400 hover:text-stone-600 text-3xl leading-5 transition-colors"
          >
            &times;
          </button>
        </div>
        <div class="text-center">
          <p class="text-stone-600 mb-4">
            Thank you for your purchase! Use this code next time for 5% off.
          </p>
          <div
            id="discountCodeDisplay"
            class="discount-code text-3xl font-bold text-white py-4 px-6 rounded-xl mb-4 inline-block"
            onclick="window.copyDiscountCode()"
          >
            FRESH5XYZ
          </div>
          <p class="text-sm text-stone-500 mb-2">Click the code to copy (oneâ€‘time use)</p>
          <div id="copyNotification" class="text-green-600 text-sm hidden">
            âœ“ Copied to clipboard!
          </div>
          <button
            onclick="window.closeDiscountModal()"
            class="mt-4 bg-amber-700 hover:bg-amber-800 text-white font-bold py-2 px-6 rounded-full transition-all duration-200 hover:scale-105 active:scale-95"
          >
            Got it!
          </button>
        </div>
      </div>
    </div>

    <!-- ========== INVOICE MODAL (PROFESSIONAL, integrated) ========== -->
    <div
      id="invoiceModal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden modal-transition"
    >
      <div
        class="bg-white rounded-2xl max-w-4xl w-full mx-4 p-0 shadow-2xl relative border border-amber-200 max-h-[90vh] overflow-y-auto transform transition-all duration-200 scale-95 opacity-0"
        id="invoiceModalContent"
      >
        <!-- INVOICE CARD (clean, no margins, directly inside modal) -->
        <div class="invoice-card w-full bg-white overflow-hidden">
          <div class="p-6 md:p-8 lg:p-10">
            <!-- header with logo and company identity -->
            <div
              class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-amber-200 pb-6 mb-6"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-12 h-12 bg-gradient-to-br from-amber-600 to-amber-800 rounded-xl flex items-center justify-center text-white shadow-md"
                >
                  <i class="fa-solid fa-mug-hot text-2xl"></i>
                </div>
                <div>
                  <h1 class="text-2xl font-bold text-stone-800 tracking-tight">
                    Bean & <span class="text-amber-700">Brew</span>
                  </h1>
                  <p class="text-xs text-stone-500 mt-0.5">since 2015 Â· microâ€‘roastery</p>
                </div>
              </div>
              <div class="text-sm text-stone-600 space-y-0.5 text-right">
                <p>123 Coffee Lane, Roastery District</p>
                <p>Portland, OR 97205, USA</p>
                <p class="flex items-center justify-end gap-2">
                  <i class="fa-regular fa-envelope text-amber-600"></i> hello@beanandbrew.com
                </p>
                <p class="flex items-center justify-end gap-2">
                  <i class="fa-regular fa-building text-amber-600"></i> VAT: US123456789
                </p>
              </div>
            </div>

            <!-- customer & invoice details (twoâ€‘column grid) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <!-- billed to â€“ dynamically filled with shipping info -->
              <div class="bg-amber-50/60 rounded-xl p-5 border border-amber-100">
                <h2
                  class="text-xs font-semibold text-amber-700 uppercase tracking-wider mb-3 flex items-center gap-1"
                >
                  <i class="fa-regular fa-user"></i> Billed to
                </h2>
                <div class="space-y-1.5 text-stone-700">
                  <p class="font-semibold text-lg" id="invoiceCustomerName">Alex Rivera</p>
                  <p class="text-sm flex items-start gap-2">
                    <i class="fa-regular fa-envelope text-amber-600 w-4 mt-0.5"></i>
                    <span id="invoiceCustomerEmail">alex.r@coffee.com</span>
                  </p>
                  <p class="text-sm flex items-start gap-2">
                    <i class="fa-regular fa-address-book text-amber-600 w-4 mt-0.5"></i>
                    <span id="invoiceCustomerPhone">+1 (503) 555â€‘0912</span>
                  </p>
                  <p class="text-sm flex items-start gap-2">
                    <i class="fa-regular fa-location-dot text-amber-600 w-4 mt-0.5"></i>
                    <span id="invoiceCustomerAddress"
                      >4825 N Williams Ave, Apt 2B, Portland, OR 97217</span
                    >
                  </p>
                </div>
              </div>

              <!-- invoice meta (right side) -->
              <div
                class="bg-white rounded-xl p-5 border border-amber-200 shadow-sm flex flex-col justify-between"
              >
                <div class="flex justify-between items-start">
                  <h2 class="text-xs font-semibold text-amber-700 uppercase tracking-wider">
                    Invoice
                  </h2>
                  <span
                    class="bg-amber-100 text-amber-800 text-xs font-mono px-3 py-1 rounded-full border border-amber-200"
                    id="invoiceNumber"
                    >#INV-2025-0421</span
                  >
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
                  <div>
                    <p class="text-stone-500 text-xs">Issue date</p>
                    <p class="font-medium text-stone-800">
                      <i class="fa-regular fa-calendar mr-1 text-amber-600"></i>
                      <span id="invoiceIssueDate">21 Apr 2025</span>
                    </p>
                  </div>
                  <div>
                    <p class="text-stone-500 text-xs">Due date</p>
                    <p class="font-medium text-stone-800">
                      <i class="fa-regular fa-calendar-check mr-1 text-amber-600"></i>
                      <span id="invoiceDueDate">05 May 2025</span>
                    </p>
                  </div>
                  <div>
                    <p class="text-stone-500 text-xs">Payment terms</p>
                    <p class="font-medium text-stone-800" id="invoiceTerms">Net 14</p>
                  </div>
                  <div>
                    <p class="text-stone-500 text-xs">Order ref</p>
                    <p class="font-medium text-stone-800" id="invoiceOrderRef">#BB-0415</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- ITEMS TABLE â€“ dynamically generated -->
            <div class="overflow-x-auto border border-amber-200 rounded-xl bg-white mb-6">
              <table class="w-full text-sm">
                <thead class="bg-amber-50 border-b border-amber-200 text-stone-700">
                  <tr>
                    <th class="px-5 py-4 text-left font-semibold">Item description</th>
                    <th class="px-5 py-4 text-right font-semibold">Qty</th>
                    <th class="px-5 py-4 text-right font-semibold">Unit price</th>
                    <th class="px-5 py-4 text-right font-semibold">Total</th>
                  </tr>
                </thead>
                <tbody id="invoiceItemsBody" class="divide-y divide-amber-100">
                  <!-- filled by js -->
                </tbody>
              </table>
            </div>

            <!-- invoice totals + discount code block -->
            <div class="mt-8 flex flex-col lg:flex-row lg:justify-between gap-6">
              <!-- discount code card (left side) with copy button -->
              <div class="w-full lg:w-1/2">
                <div
                  class="bg-gradient-to-br from-amber-50 to-white rounded-xl border border-amber-200 p-5 flex items-center justify-between gap-3 shadow-sm"
                >
                  <div class="flex items-center gap-3">
                    <div
                      class="w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center text-amber-700"
                    >
                      <i class="fa-solid fa-ticket-alt text-lg"></i>
                    </div>
                    <div>
                      <p class="text-xs text-stone-500 uppercase tracking-wide">
                        discount code for next order
                      </p>
                      <p
                        class="text-xl font-mono font-bold text-amber-800 tracking-wider"
                        id="invoiceDiscountCode"
                      >
                        5OFF-BREW42
                      </p>
                    </div>
                  </div>
                  <button
                    onclick="copyInvoiceDiscountCode()"
                    class="copy-btn bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 shadow-sm active:scale-95 focus:ring-2 focus:ring-amber-300 no-print"
                  >
                    <i class="fa-regular fa-copy"></i> copy
                  </button>
                </div>
                <p class="text-xs text-stone-400 mt-2 ml-2">
                  oneâ€‘time use Â· 5% off your next purchase
                </p>
              </div>

              <!-- subtotal / tax / total panel (right side) -->
              <div class="w-full lg:w-80 bg-stone-50 rounded-xl border border-stone-200 p-5">
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between text-stone-600">
                    <span>Subtotal</span>
                    <span class="font-medium text-stone-800" id="invoiceSubtotal">$142.50</span>
                  </div>
                  <div class="flex justify-between text-stone-600">
                    <span>Shipping (free)</span>
                    <span class="font-medium text-stone-800">$0.00</span>
                  </div>
                  <div class="flex justify-between text-stone-600">
                    <span>Tax (estimated 5%)</span>
                    <span class="font-medium text-stone-800" id="invoiceTax">$7.13</span>
                  </div>
                  <!-- discount applied (if any) -->
                  <div
                    class="flex justify-between text-green-600 border-t border-stone-200 pt-2 mt-2"
                    id="invoiceDiscountRow"
                  >
                    <span>Discount (5% welcome)</span>
                    <span id="invoiceDiscountAmount">âˆ’$7.13</span>
                  </div>
                  <div
                    class="flex justify-between font-bold text-lg text-stone-800 border-t border-stone-300 pt-3 mt-1"
                  >
                    <span>Total due</span>
                    <span class="text-amber-800" id="invoiceTotalDue">$142.50</span>
                  </div>
                </div>
                <!-- payment status note -->
                <div
                  class="mt-4 flex items-center gap-2 text-xs text-stone-500 bg-white rounded-lg p-2 border border-stone-200"
                >
                  <i class="fa-regular fa-clock text-amber-600"></i>
                  <span
                    >Payment pending â€” due by
                    <span id="invoiceDueDateSmall">05 May 2025</span></span
                  >
                </div>
              </div>
            </div>

            <!-- footer -->
            <div
              class="mt-10 pt-5 border-t border-amber-200 flex flex-col sm:flex-row justify-between items-center text-xs text-stone-500 gap-3"
            >
              <div class="flex items-center gap-4">
                <span><i class="fa-regular fa-credit-card mr-1"></i> BACS / wire transfer</span>
                <span><i class="fa-regular fa-building-columns mr-1"></i> Account: **** 8420</span>
              </div>
              <div class="flex items-center gap-3">
                <span>thank you for supporting small roasters â˜•</span>
                <span class="hidden sm:inline">Â·</span>
                <button onclick="window.print()" class="text-amber-600 hover:underline no-print">
                  print
                </button>
                <button
                  onclick="window.closeInvoiceModal()"
                  class="text-amber-600 hover:underline no-print ml-2"
                >
                  close
                </button>
              </div>
            </div>
          </div>
          <!-- end inner padding -->
        </div>
        <!-- end invoice card -->
      </div>
      <!-- end modal content -->
    </div>
    <!-- end invoice modal -->

    <!-- ========== MAIN ========== -->
    <main class="flex-grow max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
      <!-- Products section (FIRST) -->
      <section id="products" class="scroll-mt-24">
        <div class="mb-10 text-center sm:text-left">
          <p class="text-lg text-stone-600 flex items-center justify-center sm:justify-start gap-2">
            <i class="fa-regular fa-clock text-amber-600"></i>
            <span
              >roasted to order Â· todayâ€™s feature:
              <strong class="text-amber-800">Ethiopia Yirgacheffe</strong></span
            >
          </p>
          <h2 class="text-3xl md:text-4xl font-serif font-light mt-2 text-stone-800">
            shop <span class="font-bold text-amber-800">beans & teas</span>
          </h2>
          <div class="w-24 h-1 bg-amber-400 rounded-full mt-3 mx-auto sm:mx-0"></div>
        </div>

        <!-- product grid with images -->
        <div id="menuGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          <!-- items will be injected via JS -->
        </div>
      </section>

      <!-- ========== ABOUT SECTION ========== -->
      <section id="about" class="mt-20 scroll-mt-24">
        <div class="bg-white rounded-3xl shadow-sm border border-amber-100 p-8 md:p-10">
          <div class="flex flex-col md:flex-row gap-10 items-center">
            <div class="md:w-1/2">
              <h3 class="text-3xl font-serif font-light text-stone-800 mb-4">
                about <span class="font-bold text-amber-700">Bean & Brew</span>
              </h3>
              <p class="text-stone-600 leading-relaxed">
                Founded in 2015, we source the finest organic coffee beans and loose-leaf teas
                directly from farmers in Ethiopia, Colombia, and Indonesia. Every batch is
                small-batch roasted in our micro-roastery to ensure peak flavor. Our teas are
                hand-selected by certified tea masters. We believe in sustainability and fair trade
                practices â€” and we deliver fresh to your door.
              </p>
              <div class="grid grid-cols-2 gap-4 mt-6">
                <div class="flex items-center gap-2">
                  <i class="fa-solid fa-check-circle text-amber-600"></i
                  ><span class="text-sm">Direct trade</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fa-solid fa-check-circle text-amber-600"></i
                  ><span class="text-sm">Organic certified</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fa-solid fa-check-circle text-amber-600"></i
                  ><span class="text-sm">Carbon neutral</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fa-solid fa-check-circle text-amber-600"></i
                  ><span class="text-sm">100+ reviews</span>
                </div>
              </div>
            </div>
            <div class="md:w-1/2 flex justify-center">
              <img
                src="https://images.unsplash.com/photo-1442512595331-e89e73853f31?w=600&auto=format"
                alt="coffee roastery"
                class="rounded-2xl shadow-lg max-h-64 object-cover"
                loading="lazy"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- ========== CONTACT (SOCIAL ONLY) ========== -->
      <div class="mt-12 grid grid-cols-1 md:grid-cols-1 gap-6 max-w-2xl mx-auto">
        <section
          id="contact"
          class="bg-white rounded-2xl shadow-sm border border-amber-100 p-6 scroll-mt-24"
        >
          <h3 class="text-2xl font-serif font-bold text-stone-800 mb-4 flex items-center gap-2">
            <i class="fa-regular fa-comment text-amber-700"></i> connect with us
          </h3>

          <!-- Social Media Links -->
          <div class="grid grid-cols-2 gap-4 mb-6">
            <a
              href="https://facebook.com"
              target="_blank"
              class="social-icon flex items-center gap-3 p-3 bg-blue-50 rounded-xl hover:bg-blue-100 transition-all duration-200 group"
            >
              <div
                class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white text-xl transition-transform group-hover:scale-110"
              >
                <i class="fa-brands fa-facebook-f"></i>
              </div>
              <div>
                <p class="font-semibold text-stone-700">Facebook</p>
                <p class="text-xs text-blue-600">@beanandbrew</p>
              </div>
            </a>
            <a
              href="https://instagram.com"
              target="_blank"
              class="social-icon flex items-center gap-3 p-3 bg-pink-50 rounded-xl hover:bg-pink-100 transition-all duration-200 group"
            >
              <div
                class="w-10 h-10 bg-pink-600 rounded-full flex items-center justify-center text-white text-xl transition-transform group-hover:scale-110"
              >
                <i class="fa-brands fa-instagram"></i>
              </div>
              <div>
                <p class="font-semibold text-stone-700">Instagram</p>
                <p class="text-xs text-pink-600">@beanandbrew</p>
              </div>
            </a>
            <a
              href="https://telegram.org"
              target="_blank"
              class="social-icon flex items-center gap-3 p-3 bg-sky-50 rounded-xl hover:bg-sky-100 transition-all duration-200 group"
            >
              <div
                class="w-10 h-10 bg-sky-500 rounded-full flex items-center justify-center text-white text-xl transition-transform group-hover:scale-110"
              >
                <i class="fa-brands fa-telegram-plane"></i>
              </div>
              <div>
                <p class="font-semibold text-stone-700">Telegram</p>
                <p class="text-xs text-sky-600">@beanandbrew</p>
              </div>
            </a>
            <a
              href="https://twitter.com"
              target="_blank"
              class="social-icon flex items-center gap-3 p-3 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 group"
            >
              <div
                class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center text-white text-xl transition-transform group-hover:scale-110"
              >
                <i class="fa-brands fa-x-twitter"></i>
              </div>
              <div>
                <p class="font-semibold text-stone-700">X (Twitter)</p>
                <p class="text-xs text-gray-600">@beanandbrew</p>
              </div>
            </a>
          </div>

          <!-- Business Hours & Email -->
          <div class="border-t border-amber-100 pt-4">
            <div class="flex items-center gap-3 text-stone-600 mb-2">
              <i class="fa-regular fa-envelope text-amber-600"></i>
              <span>hello@beanandbrew.com</span>
            </div>
            <div class="flex items-center gap-3 text-stone-600">
              <i class="fa-regular fa-clock text-amber-600"></i>
              <span>Mon-Fri: 8am - 6pm (PST)</span>
            </div>
          </div>
        </section>
      </div>

      <!-- subtle sale banner -->
      <div
        class="mt-12 bg-gradient-to-r from-amber-100 to-amber-200 rounded-2xl p-5 flex flex-wrap items-center justify-between"
      >
        <div class="flex items-center gap-3">
          <i class="fa-solid fa-tag text-2xl text-amber-700"></i
          ><span class="font-medium text-stone-700"
            >Complete a purchase and get a 5% discount code for your next order</span
          >
        </div>
        <a
          href="#products"
          class="text-sm bg-white px-4 py-2 rounded-full text-amber-800 font-semibold shadow-sm hover:bg-amber-50 transition-all duration-200 hover:scale-105 active:scale-95"
          >shop now</a
        >
      </div>
    </main>

    <!-- ========== CART SIDEBAR (with discount input) ========== -->
    <div
      id="cartSidebar"
      class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-2xl border-l border-amber-200 transform transition-transform duration-300 ease-out translate-x-full z-20 flex flex-col"
    >
      <div class="flex items-center justify-between p-5 border-b border-amber-100 bg-amber-50">
        <h3 class="text-xl font-bold text-stone-800 flex items-center gap-2">
          <i class="fa-solid fa-bag-shopping text-amber-700"></i> your cart
        </h3>
        <button
          id="closeCartBtn"
          class="text-stone-500 hover:text-stone-800 text-2xl leading-6 transition-colors"
        >
          &times;
        </button>
      </div>
      <div id="cartItemsContainer" class="flex-grow overflow-y-auto p-5 space-y-4"></div>

      <!-- Discount code input in cart -->
      <div class="px-5 py-3 border-t border-amber-100">
        <label class="block text-sm font-medium text-stone-600 mb-1">have a discount code?</label>
        <div class="flex gap-2">
          <input
            type="text"
            id="discountInput"
            placeholder="Enter code"
            class="flex-grow border border-amber-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all duration-200"
          />
          <button
            id="applyDiscountBtn"
            class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg text-sm transition-all duration-200 hover:scale-105 active:scale-95"
          >
            apply
          </button>
        </div>
        <p id="discountMessage" class="text-xs mt-1 text-green-600 hidden"></p>
      </div>

      <div class="border-t border-amber-200 p-5 space-y-3 bg-white">
        <div class="flex justify-between text-lg font-semibold text-stone-800">
          <span>subtotal</span><span id="sidebarSubtotal">$0.00</span>
        </div>
        <div id="discountRow" class="flex justify-between text-sm text-green-600 hidden">
          <span>discount (15%)</span><span id="discountAmount">-$0.00</span>
        </div>
        <div class="flex justify-between text-lg font-bold text-stone-800">
          <span>total</span><span id="sidebarTotal">$0.00</span>
        </div>
        <button
          id="checkoutBtn"
          class="w-full bg-amber-700 hover:bg-amber-800 text-white font-bold py-3 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 btn-primary"
        >
          <i class="fa-regular fa-credit-card"></i> proceed to checkout
        </button>
        <p class="text-xs text-stone-500 text-center">free pickup Â· pay in store or online</p>
      </div>
    </div>

    <!-- ========== MY ORDERS MODAL ========== -->
    <div
      id="ordersModal"
      class="fixed inset-0 z-30 flex items-center justify-center hidden modal-transition"
    >
      <div
        class="bg-white rounded-2xl max-w-2xl w-full mx-4 p-6 shadow-2xl relative border border-amber-200 max-h-[80vh] overflow-y-auto transform transition-all duration-200 scale-95 opacity-0"
        id="ordersModalContent"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-stone-800 flex items-center gap-2">
            <i class="fa-solid fa-clipboard-list text-amber-700"></i> my orders
          </h3>
          <button
            id="closeOrdersBtn"
            class="text-stone-400 hover:text-stone-600 text-3xl leading-5 transition-colors"
          >
            &times;
          </button>
        </div>
        <div id="ordersContainer" class="space-y-4"></div>
      </div>
    </div>

    <!-- overlay -->
    <div
      id="overlay"
      class="fixed inset-0 bg-black bg-opacity-40 z-10 hidden transition-opacity duration-200"
    ></div>

    <!-- ========== PRODUCT DETAIL MODAL ========== -->
    <div
      id="productModal"
      class="fixed inset-0 z-30 flex items-center justify-center hidden modal-transition"
    >
      <div
        class="bg-white rounded-2xl max-w-md w-full mx-4 p-6 shadow-2xl relative border border-amber-200 transform transition-all duration-200 scale-95 opacity-0"
        id="productModalContent"
      >
        <div class="flex justify-between items-start">
          <div class="flex items-center gap-2">
            <div
              id="modalIconBg"
              class="w-16 h-16 rounded-xl bg-amber-100 flex items-center justify-center text-amber-800 text-2xl overflow-hidden"
            >
              <img id="modalImage" src="" alt="" class="w-full h-full object-cover hidden" />
              <i id="modalFallbackIcon" class="fa-solid fa-mug-saucer"></i>
            </div>
            <div>
              <h3 id="modalTitle" class="text-2xl font-bold text-stone-800">Product</h3>
              <p id="modalCategory" class="text-xs text-amber-600 uppercase tracking-wider">
                category
              </p>
            </div>
          </div>
          <button
            id="closeModalBtn"
            class="text-stone-400 hover:text-stone-600 text-3xl leading-5 transition-colors"
          >
            &times;
          </button>
        </div>
        <div class="mt-4">
          <p id="modalDesc" class="text-stone-600"></p>
          <div class="mt-3 flex items-baseline gap-3">
            <span id="modalPrice" class="text-3xl font-light text-amber-800"></span>
            <span class="text-sm line-through text-stone-300" id="modalOldPrice"></span>
            <span
              class="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full"
              id="modalSaleTag"
              >sale</span
            >
          </div>
        </div>
        <!-- Enhanced product details section -->
        <div class="grid grid-cols-2 gap-3 my-5 text-sm border-y border-amber-100 py-4">
          <div>
            <i class="fa-regular fa-map-pin text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalOrigin">origin: Ethiopia</span>
          </div>
          <div>
            <i class="fa-solid fa-thermometer-half text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalType">type: medium roast</span>
          </div>
          <div>
            <i class="fa-regular fa-star text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalRating">rating: 4.8 â˜… (120)</span>
          </div>
          <div>
            <i class="fa-regular fa-calendar text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalHarvest">harvest: 2024</span>
          </div>
          <div>
            <i class="fa-solid fa-droplet text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalProcess">process: washed</span>
          </div>
          <div>
            <i class="fa-regular fa-clock text-amber-600 w-5"></i
            ><span class="text-stone-600" id="modalBrew">brew: 4 min</span>
          </div>
        </div>
        <!-- Flavor notes -->
        <div class="mb-4">
          <p class="text-xs font-medium text-stone-500 mb-1">flavor notes</p>
          <div id="modalFlavorNotes" class="flex flex-wrap gap-2"></div>
        </div>
        <div class="flex items-center gap-4">
          <div class="flex items-center border border-amber-200 rounded-full">
            <button
              id="modalQtyDown"
              class="w-10 h-10 rounded-full text-amber-700 text-xl hover:bg-amber-100 transition-colors active:bg-amber-200"
            >
              âˆ’
            </button>
            <span id="modalQty" class="w-8 text-center font-semibold">1</span>
            <button
              id="modalQtyUp"
              class="w-10 h-10 rounded-full text-amber-700 text-xl hover:bg-amber-100 transition-colors active:bg-amber-200"
            >
              +
            </button>
          </div>
          <button
            id="modalAddToCart"
            class="flex-1 bg-amber-700 hover:bg-amber-800 text-white font-semibold py-2.5 rounded-full transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2"
          >
            <i class="fa-solid fa-cart-plus"></i> add to cart
          </button>
        </div>
      </div>
    </div>

    <!-- ========== CHECKOUT MODAL ========== -->
    <div
      id="checkoutModal"
      class="fixed inset-0 z-40 flex items-center justify-center hidden modal-transition"
    >
      <div
        class="bg-white rounded-2xl max-w-md w-full mx-4 p-6 shadow-2xl relative border border-amber-200 max-h-[90vh] overflow-y-auto transform transition-all duration-200 scale-95 opacity-0"
        id="checkoutModalContent"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-stone-800 flex items-center gap-2">
            <i class="fa-solid fa-bag-shopping text-amber-700"></i> checkout
          </h3>
          <button
            id="closeCheckoutBtn"
            class="text-stone-400 hover:text-stone-600 text-3xl leading-5 transition-colors"
          >
            &times;
          </button>
        </div>

        <!-- Order Summary -->
        <div class="bg-amber-50 p-4 rounded-xl mb-4">
          <p class="font-semibold text-stone-700">
            your order Â· <span id="checkoutItemCount">0 items</span>
          </p>
          <div
            id="checkoutItemsBrief"
            class="text-sm text-stone-600 mt-1 max-h-20 overflow-y-auto"
          ></div>
          <div class="flex justify-between font-bold text-lg mt-2 pt-2 border-t border-amber-200">
            <span>total</span><span id="checkoutTotalAmount">$0.00</span>
          </div>
        </div>

        <!-- SHIPPING FORM -->
        <div class="mb-6">
          <h4 class="font-semibold text-stone-700 mb-3 flex items-center gap-2">
            <i class="fa-solid fa-truck text-amber-600"></i> shipping information
          </h4>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-stone-600 mb-1">full name *</label
              ><input
                type="text"
                id="shippingName"
                required
                class="w-full border border-amber-200 rounded-lg p-2.5 focus:ring-2 focus:ring-amber-500 focus:border-amber-500"
                placeholder="John Doe"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-stone-600 mb-1">email address *</label
              ><input
                type="email"
                id="shippingEmail"
                required
                class="w-full border border-amber-200 rounded-lg p-2.5 focus:ring-2 focus:ring-amber-500"
                placeholder="john@example.com"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-stone-600 mb-1">phone number *</label
              ><input
                type="text"
                id="shippingPhone"
                required
                class="w-full border border-amber-200 rounded-lg p-2.5"
                placeholder="+1234567890"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-stone-600 mb-1">shipping address *</label
              ><textarea
                id="shippingAddress"
                required
                rows="2"
                class="w-full border border-amber-200 rounded-lg p-2.5"
                placeholder="Street, city, postal code, country"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- PAYMENT METHODS -->
        <p class="font-medium text-stone-700 mb-2">select payment method</p>
        <div class="grid gap-3 mb-5">
          <div
            id="pmKHQR"
            class="payment-method border rounded-xl p-3 flex items-center gap-3 hover:border-amber-400"
            data-method="khqr"
          >
            <div
              class="w-10 h-10 bg-gradient-to-r from-blue-800 to-blue-600 rounded-full flex items-center justify-center text-white text-xl"
            >
              <i class="fa-solid fa-qrcode text-xl"></i>
            </div>
            <div>
              <span class="font-semibold">KHQR (Bakong)</span>
              <p class="text-xs text-stone-500">scan with Bakong app</p>
            </div>
            <i class="fa-regular fa-circle-check ml-auto text-stone-300 method-check"></i>
          </div>
          <div
            id="pmPaypal"
            class="payment-method border rounded-xl p-3 flex items-center gap-3 hover:border-amber-400"
            data-method="paypal"
          >
            <div
              class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-700"
            >
              <i class="fa-brands fa-paypal text-xl"></i>
            </div>
            <div>
              <span class="font-semibold">PayPal</span>
              <p class="text-xs text-stone-500">fast & secure</p>
            </div>
            <i class="fa-regular fa-circle-check ml-auto text-stone-300 method-check"></i>
          </div>
          <div
            id="pmCash"
            class="payment-method border rounded-xl p-3 flex items-center gap-3 hover:border-amber-400"
            data-method="cash"
          >
            <div
              class="w-10 h-10 bg-green-50 rounded-full flex items-center justify-center text-green-600"
            >
              <i class="fa-solid fa-money-bill-wave text-xl"></i>
            </div>
            <div>
              <span class="font-semibold">Cash</span>
              <p class="text-xs text-stone-500">pay when you pick up</p>
            </div>
            <i class="fa-regular fa-circle-check ml-auto text-stone-300 method-check"></i>
          </div>
        </div>

        <!-- KHQR Area -->
        <div id="khqrArea" class="hidden mb-4">
          <div class="khqr-card">
            <div class="khqr-header">
              <div>
                <div class="khqr-title">ABAP PAY</div>
                <div class="khqr-subtitle">Scan. Pay. Done.</div>
              </div>
              <div class="khqr-badge">BAKONG</div>
            </div>
            <div class="khqr-merchant">
              <i class="fa-regular fa-building mr-2"></i><span>Bean & Brew Coffee</span>
            </div>
            <div class="text-center">
              <div class="qr-container">
                <img src="./image.png" alt="KHQR Code" class="qr-image" id="staticQrImage" />
              </div>
            </div>
            <div class="khqr-amount" id="qrAmount">$0.00</div>
            <div class="flex justify-between text-sm mb-2">
              <span><i class="fa-regular fa-calendar mr-1"></i> Today</span
              ><span><i class="fa-regular fa-clock mr-1"></i> <span id="qrTime">12:00</span></span>
            </div>
            <div class="khqr-footer">
              <span>MID: 125121023545441</span><span>Member of KHOC</span>
            </div>
          </div>
        </div>

        <!-- Cash Area -->
        <div id="cashArea" class="hidden mb-4 p-4 border border-amber-200 rounded-xl bg-stone-50">
          <label class="block text-sm font-medium text-stone-600 mb-1">cash given ($)</label>
          <input
            type="number"
            id="cashGiven"
            min="0"
            step="0.01"
            class="w-full p-2 border border-amber-200 rounded-lg focus:ring-2 focus:ring-amber-500"
            placeholder="0.00"
          />
          <div class="flex justify-between text-sm mt-2">
            <span>change:</span
            ><span id="changeDisplay" class="font-semibold text-green-600">$0.00</span>
          </div>
        </div>

        <!-- Complete Order Button -->
        <button
          id="confirmPaymentBtn"
          class="w-full bg-amber-700 hover:bg-amber-800 text-white font-bold py-3 rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] mt-2 disabled:opacity-40"
          disabled
        >
          complete order
        </button>
      </div>
    </div>

    <!-- footer -->
    <footer class="bg-white border-t border-amber-200 py-6 mt-6">
      <div class="max-w-6xl mx-auto px-4 text-center text-stone-500 text-sm">
        <i class="fa-regular fa-copyright"></i> 2025 Bean & Brew Â· premium coffee beans & teas
        <span class="mx-2">|</span> <i class="fa-solid fa-truck text-amber-600"></i> free shipping
        over $35
      </div>
    </footer>

    <!-- JavaScript (large, integrated) -->
    <script>
      // Global functions (defined first)
      window.copyDiscountCode = function () {
        const code = document.getElementById('discountCodeDisplay').textContent;
        navigator.clipboard.writeText(code);
        const notification = document.getElementById('copyNotification');
        notification.classList.remove('hidden');
        setTimeout(() => notification.classList.add('hidden'), 2000);
      };

      window.closeDiscountModal = function () {
        const modal = document.getElementById('discountModal');
        const content = document.getElementById('discountModalContent');
        const overlay = document.getElementById('overlay');
        if (content) {
          content.classList.remove('scale-100', 'opacity-100');
          content.classList.add('scale-95', 'opacity-0');
        }
        setTimeout(() => {
          if (modal) modal.classList.add('hidden');
          if (overlay) overlay.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        }, 200);
      };

      window.openDiscountModal = function () {
        const modal = document.getElementById('discountModal');
        const content = document.getElementById('discountModalContent');
        const overlay = document.getElementById('overlay');
        if (modal && content && overlay) {
          modal.classList.remove('hidden');
          overlay.classList.remove('hidden');
          setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
          }, 10);
        }
      };

      window.closeSuccessPopup = function () {
        const popup = document.getElementById('successPopup');
        if (popup) {
          popup.classList.add('translate-x-full', 'opacity-0');
          popup.classList.remove('translate-x-0', 'opacity-100');
          setTimeout(() => popup.classList.add('hidden'), 300);
        }
      };

      // Invoice modal functions
      window.closeInvoiceModal = function () {
        const modal = document.getElementById('invoiceModal');
        const content = document.getElementById('invoiceModalContent');
        const overlay = document.getElementById('overlay');
        if (content) {
          content.classList.remove('scale-100', 'opacity-100');
          content.classList.add('scale-95', 'opacity-0');
        }
        setTimeout(() => {
          if (modal) modal.classList.add('hidden');
          if (overlay) overlay.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        }, 200);
      };

      window.openInvoiceModal = function () {
        const modal = document.getElementById('invoiceModal');
        const content = document.getElementById('invoiceModalContent');
        const overlay = document.getElementById('overlay');
        if (modal && content && overlay) {
          modal.classList.remove('hidden');
          overlay.classList.remove('hidden');
          setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
          }, 10);
        }
      };

      window.copyInvoiceDiscountCode = function () {
        const code = document.getElementById('invoiceDiscountCode').innerText;
        navigator.clipboard.writeText(code);
        const btn = event.currentTarget;
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fa-regular fa-check"></i> copied';
        btn.classList.add('bg-green-600', 'hover:bg-green-700');
        btn.classList.remove('bg-amber-600', 'hover:bg-amber-700');
        setTimeout(() => {
          btn.innerHTML = original;
          btn.classList.remove('bg-green-600', 'hover:bg-green-700');
          btn.classList.add('bg-amber-600', 'hover:bg-amber-700');
        }, 2000);
      };

      // Main app
      document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM fully loaded');

        // ---------- PRODUCT DATA ----------
        const products = [
          {
            id: 'b1',
            name: 'Ethiopia Yirgacheffe',
            desc: 'floral, citrus, light roast Â· clean finish',
            price: 1,
            oldPrice: 22.0,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'light roast',
            origin: 'Ethiopia, Yirgacheffe',
            process: 'washed',
            harvest: '2024',
            rating: '4.9 â˜… (342)',
            brewTime: '3-4 min',
            flavorNotes: ['jasmine', 'bergamot', 'honey'],
            image: 'Ethiopia Yirgacheffe.webp',
          },
          {
            id: 'b2',
            name: 'Colombia Supremo',
            desc: 'caramel, nuts, medium roast Â· balanced',
            price: 1,
            oldPrice: null,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'medium roast',
            origin: 'Colombia, Huila',
            process: 'washed',
            harvest: '2024',
            rating: '4.7 â˜… (215)',
            brewTime: '4 min',
            flavorNotes: ['caramel', 'pecan', 'brown sugar'],
            image: 'Colombia Supremo.webp',
          },
          {
            id: 'b3',
            name: 'Sumatra Mandheling',
            desc: 'earthy, full-bodied, dark roast',
            price: 1,
            oldPrice: 24.0,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'dark roast',
            origin: 'Indonesia, Sumatra',
            process: 'wet-hulled',
            harvest: '2023',
            rating: '4.6 â˜… (178)',
            brewTime: '4-5 min',
            flavorNotes: ['cedar', 'dark chocolate', 'herbal'],
            image: 'Sumatra Mandheling.webp',
          },
          {
            id: 'b4',
            name: 'Guatemala Antigua',
            desc: 'chocolate, spice, medium-dark',
            price: 1.0,
            oldPrice: 21.0,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'medium-dark',
            origin: 'Guatemala, Antigua',
            process: 'washed',
            harvest: '2024',
            rating: '4.8 â˜… (156)',
            brewTime: '4 min',
            flavorNotes: ['cocoa', 'cinnamon', 'baked apple'],
            image: 'Guatemala Antigua.jpg',
          },
          {
            id: 'b5',
            name: 'Kenya AA',
            desc: 'bright, winey, complex Â· medium roast',
            price: 1,
            oldPrice: 26.0,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'medium roast',
            origin: 'Kenya, Nyeri',
            process: 'washed',
            harvest: '2024',
            rating: '4.9 â˜… (289)',
            brewTime: '3-4 min',
            flavorNotes: ['blackcurrant', 'tomato', 'brown sugar'],
            image: 'Kenya AA.jpg',
          },
          {
            id: 'b6',
            name: 'Costa Rica TarrazÃº',
            desc: 'honey, peach, light-medium',
            price: 1,
            oldPrice: null,
            category: 'coffee beans',
            icon: 'fa-seedling',
            type: 'light-medium',
            origin: 'Costa Rica, TarrazÃº',
            process: 'honey',
            harvest: '2024',
            rating: '4.7 â˜… (132)',
            brewTime: '3-4 min',
            flavorNotes: ['peach', 'honey', 'vanilla'],
            image: 'Costa Rica Tarrazu.jpg',
          },
          {
            id: 't1',
            name: 'Jasmine Pearls',
            desc: 'hand-rolled, floral, smooth',
            price: 1,
            oldPrice: 18.0,
            category: 'green tea',
            icon: 'fa-leaf',
            type: 'green tea',
            origin: 'China, Fujian',
            process: 'scented',
            harvest: '2024',
            rating: '4.8 â˜… (164)',
            brewTime: '2-3 min',
            flavorNotes: ['jasmine', 'cream', 'silk'],
            image: 'Jasmine Pearls.webp',
          },
          {
            id: 't2',
            name: 'Earl Grey',
            desc: 'bergamot, black tea',
            price: 1,
            oldPrice: null,
            category: 'black tea',
            icon: 'fa-leaf',
            type: 'black tea',
            origin: 'India, Assam',
            process: 'orthodox',
            harvest: '2024',
            rating: '4.6 â˜… (198)',
            brewTime: '3-4 min',
            flavorNotes: ['bergamot', 'malt', 'honey'],
            image: 'Earl Grey.avif',
          },
          {
            id: 't3',
            name: 'Chamomile Lavender',
            desc: 'caffeine-free, calming',
            price: 1,
            oldPrice: 14.5,
            category: 'herbal tea',
            icon: 'fa-leaf',
            type: 'herbal',
            origin: 'Egypt, Nile',
            process: 'air-dried',
            harvest: '2024',
            rating: '4.7 â˜… (92)',
            brewTime: '5-7 min',
            flavorNotes: ['chamomile', 'lavender', 'honey'],
            image: 'Chamomile Lavender.avif',
          },
          {
            id: 't4',
            name: 'Sencha Green',
            desc: 'fresh, grassy, steamed',
            price: 1,
            oldPrice: 16.0,
            category: 'green tea',
            icon: 'fa-leaf',
            type: 'green tea',
            origin: 'Japan, Uji',
            process: 'steamed',
            harvest: '2024',
            rating: '4.8 â˜… (143)',
            brewTime: '1-2 min',
            flavorNotes: ['grass', 'umami', 'nori'],
            image: 'Sencha Green.jpg',
          },
          {
            id: 't5',
            name: 'Masala Chai',
            desc: 'spiced black tea, bold',
            price: 1,
            oldPrice: 17.0,
            category: 'black tea',
            icon: 'fa-leaf',
            type: 'chai',
            origin: 'India, Kerala',
            process: 'CTC',
            harvest: '2024',
            rating: '4.8 â˜… (207)',
            brewTime: '5 min',
            flavorNotes: ['cinnamon', 'cardamom', 'clove'],
            image: 'Masala Chai.webp',
          },
          {
            id: 't6',
            name: 'White Peony',
            desc: 'delicate, sweet, Bai Mudan',
            price: 1,
            oldPrice: 22.0,
            category: 'white tea',
            icon: 'fa-leaf',
            type: 'white tea',
            origin: 'China, Fuding',
            process: 'air-dried',
            harvest: '2024',
            rating: '4.7 â˜… (88)',
            brewTime: '2-3 min',
            flavorNotes: ['melon', 'hay', 'floral'],
            image: 'White Peony.jpg',
          },
        ];

        // ---------- STATE ----------
        let cart = [];
        let orders = [];
        let activeDiscount = null;
        let discountApplied = false;
        let usedDiscountCodes = new Set();
        let currentModalProduct = null;
        let selectedMethod = null;
        let popupTimeout;

        // DOM cache
        const DOM = {
          menuGrid: document.getElementById('menuGrid'),
          cartCount: document.getElementById('cartCount'),
          cartTotalDisplay: document.getElementById('cartTotalDisplay'),
          cartSidebar: document.getElementById('cartSidebar'),
          overlay: document.getElementById('overlay'),
          cartItemsContainer: document.getElementById('cartItemsContainer'),
          sidebarSubtotal: document.getElementById('sidebarSubtotal'),
          sidebarTotal: document.getElementById('sidebarTotal'),
          discountRow: document.getElementById('discountRow'),
          discountAmount: document.getElementById('discountAmount'),
          discountInput: document.getElementById('discountInput'),
          applyDiscountBtn: document.getElementById('applyDiscountBtn'),
          discountMessage: document.getElementById('discountMessage'),
          cartToggleBtn: document.getElementById('cartToggleBtn'),
          closeCartBtn: document.getElementById('closeCartBtn'),
          checkoutBtn: document.getElementById('checkoutBtn'),
          myOrdersBtn: document.getElementById('myOrdersBtn'),
          ordersModal: document.getElementById('ordersModal'),
          closeOrdersBtn: document.getElementById('closeOrdersBtn'),
          ordersContainer: document.getElementById('ordersContainer'),
          productModal: document.getElementById('productModal'),
          modalImage: document.getElementById('modalImage'),
          modalFallbackIcon: document.getElementById('modalFallbackIcon'),
          modalTitle: document.getElementById('modalTitle'),
          modalCategory: document.getElementById('modalCategory'),
          modalDesc: document.getElementById('modalDesc'),
          modalPrice: document.getElementById('modalPrice'),
          modalOldPrice: document.getElementById('modalOldPrice'),
          modalSaleTag: document.getElementById('modalSaleTag'),
          modalOrigin: document.getElementById('modalOrigin'),
          modalType: document.getElementById('modalType'),
          modalRating: document.getElementById('modalRating'),
          modalHarvest: document.getElementById('modalHarvest'),
          modalProcess: document.getElementById('modalProcess'),
          modalBrew: document.getElementById('modalBrew'),
          modalFlavorNotes: document.getElementById('modalFlavorNotes'),
          modalQtySpan: document.getElementById('modalQty'),
          modalQtyDown: document.getElementById('modalQtyDown'),
          modalQtyUp: document.getElementById('modalQtyUp'),
          modalAddToCart: document.getElementById('modalAddToCart'),
          closeModalBtn: document.getElementById('closeModalBtn'),
          checkoutModal: document.getElementById('checkoutModal'),
          closeCheckoutBtn: document.getElementById('closeCheckoutBtn'),
          checkoutItemCount: document.getElementById('checkoutItemCount'),
          checkoutItemsBrief: document.getElementById('checkoutItemsBrief'),
          checkoutTotalAmount: document.getElementById('checkoutTotalAmount'),
          pmKHQR: document.getElementById('pmKHQR'),
          pmPaypal: document.getElementById('pmPaypal'),
          pmCash: document.getElementById('pmCash'),
          khqrArea: document.getElementById('khqrArea'),
          cashArea: document.getElementById('cashArea'),
          cashGiven: document.getElementById('cashGiven'),
          changeDisplay: document.getElementById('changeDisplay'),
          confirmPaymentBtn: document.getElementById('confirmPaymentBtn'),
          qrAmount: document.getElementById('qrAmount'),
          qrTime: document.getElementById('qrTime'),
          successPopup: document.getElementById('successPopup'),
          popupMessage: document.getElementById('popupMessage'),
          popupProgress: document.getElementById('popupProgress'),
          headerDiscountBadge: document.getElementById('headerDiscountBadge'),
          headerDiscountCode: document.getElementById('headerDiscountCode'),
          discountModal: document.getElementById('discountModal'),
          discountModalContent: document.getElementById('discountModalContent'),
          discountCodeDisplay: document.getElementById('discountCodeDisplay'),
          productModalContent: document.getElementById('productModalContent'),
          checkoutModalContent: document.getElementById('checkoutModalContent'),
          ordersModalContent: document.getElementById('ordersModalContent'),
          shippingName: document.getElementById('shippingName'),
          shippingEmail: document.getElementById('shippingEmail'),
          shippingPhone: document.getElementById('shippingPhone'),
          shippingAddress: document.getElementById('shippingAddress'),
          staticQrImage: document.getElementById('staticQrImage'),
          // invoice modal fields
          invoiceModal: document.getElementById('invoiceModal'),
          invoiceModalContent: document.getElementById('invoiceModalContent'),
          invoiceCustomerName: document.getElementById('invoiceCustomerName'),
          invoiceCustomerEmail: document.getElementById('invoiceCustomerEmail'),
          invoiceCustomerPhone: document.getElementById('invoiceCustomerPhone'),
          invoiceCustomerAddress: document.getElementById('invoiceCustomerAddress'),
          invoiceNumber: document.getElementById('invoiceNumber'),
          invoiceIssueDate: document.getElementById('invoiceIssueDate'),
          invoiceDueDate: document.getElementById('invoiceDueDate'),
          invoiceTerms: document.getElementById('invoiceTerms'),
          invoiceOrderRef: document.getElementById('invoiceOrderRef'),
          invoiceItemsBody: document.getElementById('invoiceItemsBody'),
          invoiceDiscountCode: document.getElementById('invoiceDiscountCode'),
          invoiceSubtotal: document.getElementById('invoiceSubtotal'),
          invoiceTax: document.getElementById('invoiceTax'),
          invoiceDiscountRow: document.getElementById('invoiceDiscountRow'),
          invoiceDiscountAmount: document.getElementById('invoiceDiscountAmount'),
          invoiceTotalDue: document.getElementById('invoiceTotalDue'),
          invoiceDueDateSmall: document.getElementById('invoiceDueDateSmall'),
        };

        const formatPrice = (p) => `$${p.toFixed(2)}`;

        function updateQRTime() {
          const now = new Date();
          if (DOM.qrTime)
            DOM.qrTime.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function openModalWithAnimation(modal, content) {
          if (!modal || !content) return;
          modal.classList.remove('hidden');
          activeModal = modal;
          void modal.offsetWidth;
          content.classList.remove('scale-95', 'opacity-0');
          content.classList.add('scale-100', 'opacity-100');
          DOM.overlay.classList.remove('hidden');
          document.body.classList.add('overflow-hidden');
        }

        function closeModalWithAnimation(modal, content) {
          if (!modal || !content) return;
          content.classList.remove('scale-100', 'opacity-100');
          content.classList.add('scale-95', 'opacity-0');
          setTimeout(() => {
            modal.classList.add('hidden');
            if (activeModal === modal) activeModal = null;
            if (!activeModal && DOM.cartSidebar.classList.contains('translate-x-full')) {
              DOM.overlay.classList.add('hidden');
              document.body.classList.remove('overflow-hidden');
            }
          }, 200);
        }

        window.showSuccessPopup = function (orderDetails) {
          if (popupTimeout) clearTimeout(popupTimeout);
          if (DOM.popupMessage)
            DOM.popupMessage.textContent = `Your order of ${orderDetails.itemCount} item${orderDetails.itemCount > 1 ? 's' : ''} (${formatPrice(orderDetails.total)}) has been placed!`;
          DOM.successPopup.classList.remove('hidden');
          void DOM.successPopup.offsetWidth;
          DOM.successPopup.classList.remove('translate-x-full', 'opacity-0');
          DOM.successPopup.classList.add('translate-x-0', 'opacity-100');
          if (DOM.popupProgress) {
            DOM.popupProgress.style.width = '100%';
            setTimeout(() => (DOM.popupProgress.style.width = '0%'), 50);
          }
          popupTimeout = setTimeout(() => window.closeSuccessPopup(), 5000);
        };

        function generateFivePercentCode() {
          const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
          let code = '5OFF-';
          for (let i = 0; i < 6; i++) code += chars[Math.floor(Math.random() * chars.length)];
          return code;
        }

        // Cart functions
        function calculateTotals() {
          const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
          let total = subtotal;
          if (discountApplied) {
            if (window.discountPercent === 5) {
              const d = subtotal * 0.05;
              total = subtotal - d;
              if (DOM.discountAmount) DOM.discountAmount.textContent = `-$${d.toFixed(2)}`;
            } else {
              const d = subtotal * 0.15;
              total = subtotal - d;
              if (DOM.discountAmount) DOM.discountAmount.textContent = `-$${d.toFixed(2)}`;
            }
            if (DOM.discountRow) DOM.discountRow.classList.remove('hidden');
          } else {
            if (DOM.discountRow) DOM.discountRow.classList.add('hidden');
          }
          return { subtotal, total };
        }

        function refreshCartUI() {
          const { subtotal, total } = calculateTotals();
          const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
          if (DOM.cartCount) DOM.cartCount.textContent = totalItems;
          if (DOM.cartTotalDisplay) DOM.cartTotalDisplay.textContent = formatPrice(total);
          if (DOM.sidebarSubtotal) DOM.sidebarSubtotal.textContent = formatPrice(subtotal);
          if (DOM.sidebarTotal) DOM.sidebarTotal.textContent = formatPrice(total);
          if (DOM.cartCount) {
            DOM.cartCount.classList.add('cart-badge-update');
            setTimeout(() => DOM.cartCount.classList.remove('cart-badge-update'), 150);
          }
          if (cart.length === 0) {
            if (DOM.cartItemsContainer)
              DOM.cartItemsContainer.innerHTML = `<div class="text-stone-500 text-center py-8">your cart is empty<br> <i class="fa-regular fa-face-smile mt-2 text-amber-600 text-2xl"></i></div>`;
          } else {
            let html = '';
            cart.forEach((item) => {
              html += `<div class="flex items-start gap-3 border-b border-amber-100 pb-3" data-id="${item.id}"><div class="w-12 h-12 rounded-lg bg-amber-100 flex-shrink-0 overflow-hidden"><img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover"></div><div class="flex-grow"><div class="flex justify-between"><h4 class="font-semibold text-stone-800">${item.name}</h4><span class="text-sm font-medium text-amber-800">${formatPrice(item.price)}</span></div><div class="flex justify-between items-center mt-1"><span class="text-xs text-stone-500">qty ${item.quantity}</span><div class="flex gap-2"><button class="cart-qty-btn text-xs bg-amber-200 w-6 h-6 rounded-full hover:bg-amber-300" data-id="${item.id}" data-delta="-1">âˆ’</button><span class="text-sm w-4 text-center">${item.quantity}</span><button class="cart-qty-btn text-xs bg-amber-200 w-6 h-6 rounded-full hover:bg-amber-300" data-id="${item.id}" data-delta="1">+</button></div></div></div></div>`;
            });
            if (DOM.cartItemsContainer) DOM.cartItemsContainer.innerHTML = html;
            DOM.cartItemsContainer.querySelectorAll('.cart-qty-btn').forEach((btn) => {
              btn.addEventListener('click', (e) => {
                e.stopPropagation();
                updateQuantity(btn.dataset.id, parseInt(btn.dataset.delta, 10));
              });
            });
          }
        }

        window.discountPercent = 15;
        if (DOM.applyDiscountBtn) {
          DOM.applyDiscountBtn.addEventListener('click', () => {
            const code = DOM.discountInput ? DOM.discountInput.value.trim().toUpperCase() : '';
            if (usedDiscountCodes.has(code)) {
              discountApplied = true;
              window.discountPercent = 5;
              if (DOM.discountMessage) {
                DOM.discountMessage.textContent = 'âœ“ 5% discount applied!';
                DOM.discountMessage.classList.remove('hidden', 'text-red-600');
                DOM.discountMessage.classList.add('text-green-600');
              }
              usedDiscountCodes.delete(code);
              if (DOM.headerDiscountCode && DOM.headerDiscountCode.textContent === code)
                DOM.headerDiscountBadge.classList.add('hidden');
              refreshCartUI();
            } else if (activeDiscount && code === activeDiscount) {
              discountApplied = true;
              window.discountPercent = 15;
              if (DOM.discountMessage) {
                DOM.discountMessage.textContent = 'âœ“ 15% discount applied!';
                DOM.discountMessage.classList.remove('hidden', 'text-red-600');
                DOM.discountMessage.classList.add('text-green-600');
              }
              refreshCartUI();
            } else {
              if (DOM.discountMessage) {
                DOM.discountMessage.textContent = 'âœ— Invalid or expired discount code';
                DOM.discountMessage.classList.remove('hidden', 'text-green-600');
                DOM.discountMessage.classList.add('text-red-600');
              }
              discountApplied = false;
              refreshCartUI();
            }
          });
        }

        function updateQuantity(id, delta) {
          const index = cart.findIndex((i) => i.id === id);
          if (index === -1) return;
          const newQty = cart[index].quantity + delta;
          if (newQty <= 0) cart.splice(index, 1);
          else cart[index].quantity = newQty;
          refreshCartUI();
        }

        function addToCart(product, qty = 1) {
          const existing = cart.find((i) => i.id === product.id);
          if (existing) existing.quantity += qty;
          else
            cart.push({
              id: product.id,
              name: product.name,
              price: product.price,
              quantity: qty,
              icon: product.icon,
              image: product.image,
            });
          refreshCartUI();
          openCart();
        }

        function openCart() {
          if (DOM.cartSidebar) {
            DOM.cartSidebar.classList.remove('translate-x-full');
            DOM.overlay.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
          }
        }
        function closeCart() {
          if (DOM.cartSidebar) {
            DOM.cartSidebar.classList.add('translate-x-full');
            if (!activeModal) {
              DOM.overlay.classList.add('hidden');
              document.body.classList.remove('overflow-hidden');
            }
          }
        }

        // Render menu
        function renderMenu() {
          if (!DOM.menuGrid) return;
          let html = '';
          products.forEach((item) => {
            html += `<div class="menu-card bg-white rounded-2xl shadow-sm border border-amber-100 overflow-hidden hover:border-amber-300 cursor-pointer" data-id="${item.id}"><img src="${item.image}" alt="${item.name}" class="product-image" loading="lazy"><div class="p-5"><div class="flex items-start justify-between"><h3 class="font-bold text-xl text-stone-800">${item.name}</h3><span class="bg-amber-50 text-amber-800 text-sm font-semibold px-3 py-1 rounded-full">${formatPrice(item.price)}</span></div><p class="text-stone-500 text-sm mt-1">${item.desc}</p><button class="add-to-cart-btn mt-4 w-full bg-amber-600 hover:bg-amber-700 text-white py-2.5 rounded-xl font-medium transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 btn-primary" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}" data-icon="${item.icon}" data-image="${item.image}"><i class="fa-solid fa-cart-plus"></i> add to cart</button></div></div>`;
          });
          DOM.menuGrid.innerHTML = html;
          DOM.menuGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.menu-card');
            if (!card) return;
            const addBtn = e.target.closest('.add-to-cart-btn');
            if (addBtn) {
              e.stopPropagation();
              addToCart({
                id: addBtn.dataset.id,
                name: addBtn.dataset.name,
                price: parseFloat(addBtn.dataset.price),
                icon: addBtn.dataset.icon,
                image: addBtn.dataset.image,
              });
            } else {
              const product = products.find((p) => p.id === card.dataset.id);
              if (product) openModal(product);
            }
          });
        }

        function openModal(product) {
          currentModalProduct = product;
          if (product.image && DOM.modalImage) {
            DOM.modalImage.src = product.image;
            DOM.modalImage.classList.remove('hidden');
            if (DOM.modalFallbackIcon) DOM.modalFallbackIcon.classList.add('hidden');
          } else {
            if (DOM.modalImage) DOM.modalImage.classList.add('hidden');
            if (DOM.modalFallbackIcon) {
              DOM.modalFallbackIcon.classList.remove('hidden');
              DOM.modalFallbackIcon.className = `fa-solid ${product.icon}`;
            }
          }
          if (DOM.modalTitle) DOM.modalTitle.textContent = product.name;
          if (DOM.modalCategory) DOM.modalCategory.textContent = product.category;
          if (DOM.modalDesc) DOM.modalDesc.textContent = product.desc;
          if (DOM.modalPrice) DOM.modalPrice.textContent = formatPrice(product.price);
          if (DOM.modalOrigin) DOM.modalOrigin.textContent = `origin: ${product.origin}`;
          if (DOM.modalType) DOM.modalType.textContent = `type: ${product.type}`;
          if (DOM.modalRating) DOM.modalRating.textContent = `rating: ${product.rating}`;
          if (DOM.modalHarvest) DOM.modalHarvest.textContent = `harvest: ${product.harvest}`;
          if (DOM.modalProcess) DOM.modalProcess.textContent = `process: ${product.process}`;
          if (DOM.modalBrew) DOM.modalBrew.textContent = `brew: ${product.brewTime}`;
          if (DOM.modalFlavorNotes)
            DOM.modalFlavorNotes.innerHTML = product.flavorNotes
              .map(
                (n) =>
                  `<span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-xs">${n}</span>`
              )
              .join('');
          if (product.oldPrice) {
            if (DOM.modalOldPrice) {
              DOM.modalOldPrice.textContent = formatPrice(product.oldPrice);
              DOM.modalOldPrice.classList.remove('hidden');
            }
            if (DOM.modalSaleTag) DOM.modalSaleTag.classList.remove('hidden');
          } else {
            if (DOM.modalOldPrice) DOM.modalOldPrice.classList.add('hidden');
            if (DOM.modalSaleTag) DOM.modalSaleTag.classList.add('hidden');
          }
          if (DOM.modalQtySpan) DOM.modalQtySpan.textContent = '1';
          openModalWithAnimation(DOM.productModal, DOM.productModalContent);
        }
        function closeModal() {
          closeModalWithAnimation(DOM.productModal, DOM.productModalContent);
        }
        if (DOM.modalQtyUp)
          DOM.modalQtyUp.addEventListener('click', () => {
            let q = parseInt(DOM.modalQtySpan ? DOM.modalQtySpan.textContent : '1');
            if (DOM.modalQtySpan) DOM.modalQtySpan.textContent = q + 1;
          });
        if (DOM.modalQtyDown)
          DOM.modalQtyDown.addEventListener('click', () => {
            let q = parseInt(DOM.modalQtySpan ? DOM.modalQtySpan.textContent : '1');
            if (q > 1 && DOM.modalQtySpan) DOM.modalQtySpan.textContent = q - 1;
          });
        if (DOM.modalAddToCart)
          DOM.modalAddToCart.addEventListener('click', () => {
            if (currentModalProduct) {
              addToCart(
                currentModalProduct,
                parseInt(DOM.modalQtySpan ? DOM.modalQtySpan.textContent : '1')
              );
              closeModal();
            }
          });
        if (DOM.closeModalBtn) DOM.closeModalBtn.addEventListener('click', closeModal);

        // Checkout functions
        function validateShippingForm() {
          const name = DOM.shippingName?.value.trim() || '';
          const email = DOM.shippingEmail?.value.trim() || '';
          const phone = DOM.shippingPhone?.value.trim() || '';
          const address = DOM.shippingAddress?.value.trim() || '';
          return name && email && phone && address;
        }

        function selectMethod(method, element) {
          if (!validateShippingForm()) {
            alert('Please fill in all shipping information first');
            return;
          }
          document.querySelectorAll('.payment-method').forEach((el) => {
            el.classList.remove('selected', 'border-amber-600', 'bg-amber-50');
            const check = el.querySelector('.method-check');
            if (check) {
              check.classList.remove('text-amber-600');
              check.classList.add('text-stone-300');
            }
          });
          element.classList.add('selected', 'border-amber-600', 'bg-amber-50');
          const check = element.querySelector('.method-check');
          if (check) {
            check.classList.remove('text-stone-300');
            check.classList.add('text-amber-600');
          }
          selectedMethod = method;
          if (DOM.khqrArea) DOM.khqrArea.classList.add('hidden');
          if (DOM.cashArea) DOM.cashArea.classList.add('hidden');
          if (method === 'khqr' && DOM.khqrArea) DOM.khqrArea.classList.remove('hidden');
          if (method === 'cash' && DOM.cashArea) DOM.cashArea.classList.remove('hidden');
          if (DOM.confirmPaymentBtn) DOM.confirmPaymentBtn.disabled = false;
        }

        if (DOM.pmKHQR)
          DOM.pmKHQR.addEventListener('click', () => selectMethod('khqr', DOM.pmKHQR));
        if (DOM.pmPaypal)
          DOM.pmPaypal.addEventListener('click', () => selectMethod('paypal', DOM.pmPaypal));
        if (DOM.pmCash)
          DOM.pmCash.addEventListener('click', () => selectMethod('cash', DOM.pmCash));
        if (DOM.cashGiven)
          DOM.cashGiven.addEventListener('input', () => {
            const { total } = calculateTotals();
            const given = parseFloat(DOM.cashGiven.value) || 0;
            if (DOM.changeDisplay)
              DOM.changeDisplay.textContent = formatPrice(given >= total ? given - total : 0);
          });

        function openCheckout() {
          if (cart.length === 0) {
            alert('Cart is empty');
            return;
          }
          selectedMethod = null;
          document.querySelectorAll('.payment-method').forEach((el) => {
            el.classList.remove('selected', 'border-amber-600', 'bg-amber-50');
            const check = el.querySelector('.method-check');
            if (check) {
              check.classList.remove('text-amber-600');
              check.classList.add('text-stone-300');
            }
          });
          if (DOM.khqrArea) DOM.khqrArea.classList.add('hidden');
          if (DOM.cashArea) DOM.khqrArea?.classList.add('hidden');
          if (DOM.confirmPaymentBtn) DOM.confirmPaymentBtn.disabled = true;
          const totalItems = cart.reduce((acc, i) => acc + i.quantity, 0);
          if (DOM.checkoutItemCount)
            DOM.checkoutItemCount.textContent =
              totalItems + (totalItems === 1 ? ' item' : ' items');
          let brief = '';
          cart.slice(0, 3).forEach((i) => (brief += `<div>${i.quantity}x ${i.name}</div>`));
          if (cart.length > 3)
            brief += `<div class="text-stone-400">+${cart.length - 3} more</div>`;
          if (DOM.checkoutItemsBrief) DOM.checkoutItemsBrief.innerHTML = brief;
          const { total } = calculateTotals();
          if (DOM.checkoutTotalAmount) DOM.checkoutTotalAmount.textContent = formatPrice(total);
          if (DOM.qrAmount) DOM.qrAmount.textContent = formatPrice(total);
          openModalWithAnimation(DOM.checkoutModal, DOM.checkoutModalContent);
        }
        function closeCheckout() {
          closeModalWithAnimation(DOM.checkoutModal, DOM.checkoutModalContent);
        }

        // Populate invoice modal with order data
        function populateInvoiceModal(order, newFiveCode) {
          if (DOM.invoiceCustomerName) DOM.invoiceCustomerName.textContent = order.shipping.name;
          if (DOM.invoiceCustomerEmail) DOM.invoiceCustomerEmail.textContent = order.shipping.email;
          if (DOM.invoiceCustomerPhone) DOM.invoiceCustomerPhone.textContent = order.shipping.phone;
          if (DOM.invoiceCustomerAddress)
            DOM.invoiceCustomerAddress.textContent = order.shipping.address;
          if (DOM.invoiceNumber)
            DOM.invoiceNumber.textContent = `#INV-${order.id.toString().slice(-8)}`;
          const today = new Date().toLocaleDateString('en-US', {
            day: '2-digit',
            month: 'short',
            year: 'numeric',
          });
          if (DOM.invoiceIssueDate) DOM.invoiceIssueDate.textContent = today;
          const due = new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toLocaleDateString('en-US', {
            day: '2-digit',
            month: 'short',
            year: 'numeric',
          });
          if (DOM.invoiceDueDate) DOM.invoiceDueDate.textContent = due;
          if (DOM.invoiceDueDateSmall) DOM.invoiceDueDateSmall.textContent = due;
          if (DOM.invoiceOrderRef)
            DOM.invoiceOrderRef.textContent = `#BB-${order.id.toString().slice(-4)}`;
          // Items table
          let itemsHtml = '';
          order.items.forEach((item) => {
            itemsHtml += `<tr><td class="px-5 py-4"><div class="font-medium text-stone-800">${item.name}</div><div class="text-xs text-stone-500 mt-0.5">12oz bag</div></td><td class="px-5 py-4 text-right text-stone-700">${item.quantity}</td><td class="px-5 py-4 text-right text-stone-700">${formatPrice(item.price)}</td><td class="px-5 py-4 text-right font-medium text-stone-800">${formatPrice(item.price * item.quantity)}</td></tr>`;
          });
          if (DOM.invoiceItemsBody) DOM.invoiceItemsBody.innerHTML = itemsHtml;
          // Totals
          const subtotal = order.items.reduce((acc, i) => acc + i.price * i.quantity, 0);
          const tax = subtotal * 0.05;
          const discountVal = order.discountApplied === '5%' ? subtotal * 0.05 : 0;
          const total = order.total;
          if (DOM.invoiceSubtotal) DOM.invoiceSubtotal.textContent = formatPrice(subtotal);
          if (DOM.invoiceTax) DOM.invoiceTax.textContent = formatPrice(tax);
          if (order.discountApplied) {
            if (DOM.invoiceDiscountRow) DOM.invoiceDiscountRow.classList.remove('hidden');
            if (DOM.invoiceDiscountAmount)
              DOM.invoiceDiscountAmount.textContent = `âˆ’${formatPrice(discountVal)}`;
          } else {
            if (DOM.invoiceDiscountRow) DOM.invoiceDiscountRow.classList.add('hidden');
          }
          if (DOM.invoiceTotalDue) DOM.invoiceTotalDue.textContent = formatPrice(total);
          if (DOM.invoiceDiscountCode) DOM.invoiceDiscountCode.textContent = newFiveCode;
        }

        if (DOM.confirmPaymentBtn) {
          DOM.confirmPaymentBtn.addEventListener('click', () => {
            if (!selectedMethod) return;
            if (!validateShippingForm()) {
              alert('Please fill in all shipping information');
              return;
            }
            const { total } = calculateTotals();
            if (selectedMethod === 'cash') {
              const given = parseFloat(DOM.cashGiven?.value || '0') || 0;
              if (given < total) {
                alert('Insufficient cash given');
                return;
              }
            }
            const shippingInfo = {
              name: DOM.shippingName?.value.trim() || '',
              email: DOM.shippingEmail?.value.trim() || '',
              phone: DOM.shippingPhone?.value.trim() || '',
              address: DOM.shippingAddress?.value.trim() || '',
            };
            const order = {
              id: Date.now(),
              date: new Date().toLocaleString(),
              items: cart.map((i) => ({ name: i.name, quantity: i.quantity, price: i.price })),
              total: total,
              method: selectedMethod,
              discountApplied: discountApplied
                ? window.discountPercent === 5
                  ? '5%'
                  : '15%'
                : null,
              shipping: shippingInfo,
            };
            orders.push(order);
            const newFiveCode = generateFivePercentCode();
            usedDiscountCodes.add(newFiveCode);
            if (DOM.headerDiscountCode) DOM.headerDiscountCode.textContent = newFiveCode;
            if (DOM.discountCodeDisplay) DOM.discountCodeDisplay.textContent = newFiveCode;
            DOM.headerDiscountBadge.classList.remove('hidden');
            populateInvoiceModal(order, newFiveCode); // fill invoice modal with this order + new code

            const itemCount = cart.reduce((acc, i) => acc + i.quantity, 0);
            window.showSuccessPopup({ itemCount, total });

            cart = [];
            discountApplied = false;
            window.discountPercent = 15;
            refreshCartUI();
            closeCheckout();
            closeCart();
            if (!DOM.productModal.classList.contains('hidden')) closeModal();
            if (DOM.shippingName) DOM.shippingName.value = '';
            if (DOM.shippingEmail) DOM.shippingEmail.value = '';
            if (DOM.shippingPhone) DOM.shippingPhone.value = '';
            if (DOM.shippingAddress) DOM.shippingAddress.value = '';
            // after success, open invoice modal automatically
            window.openInvoiceModal();
          });
        }

        // Orders modal
        function openOrders() {
          if (orders.length === 0) {
            if (DOM.ordersContainer)
              DOM.ordersContainer.innerHTML = `<div class="text-stone-500 text-center py-8">you haven't placed any orders yet<br> <i class="fa-regular fa-face-smile mt-2 text-amber-600"></i></div>`;
          } else {
            let html = '';
            orders
              .slice()
              .reverse()
              .forEach((order) => {
                html += `<div class="border border-amber-200 rounded-xl p-4 bg-amber-50/50"><div class="flex justify-between text-sm text-stone-500"><span>${order.date}</span><span class="font-mono">#${order.id.toString().slice(-6)}</span></div><div class="mt-2 space-y-1">`;
                order.items.forEach((item) => {
                  html += `<div class="flex justify-between text-stone-700"><span>${item.quantity}x ${item.name}</span><span>${formatPrice(item.price)}</span></div>`;
                });
                html += `</div><div class="flex justify-between font-bold mt-2 pt-2 border-t border-amber-200"><span>total</span><span>${formatPrice(order.total)}</span></div><div class="text-xs text-amber-600 mt-1">paid via ${order.method} ${order.discountApplied ? 'Â· ' + order.discountApplied + ' off' : ''}</div><div class="text-xs text-stone-500 mt-2 bg-amber-100/50 p-2 rounded"><i class="fa-solid fa-truck mr-1"></i> shipping to: ${order.shipping.name}</div></div>`;
              });
            if (DOM.ordersContainer) DOM.ordersContainer.innerHTML = html;
          }
          openModalWithAnimation(DOM.ordersModal, DOM.ordersModalContent);
        }
        function closeOrders() {
          closeModalWithAnimation(DOM.ordersModal, DOM.ordersModalContent);
        }

        // Event listeners
        if (DOM.checkoutBtn) DOM.checkoutBtn.addEventListener('click', openCheckout);
        if (DOM.closeCheckoutBtn) DOM.closeCheckoutBtn.addEventListener('click', closeCheckout);
        if (DOM.myOrdersBtn) DOM.myOrdersBtn.addEventListener('click', openOrders);
        if (DOM.closeOrdersBtn) DOM.closeOrdersBtn.addEventListener('click', closeOrders);
        if (DOM.overlay)
          DOM.overlay.addEventListener('click', () => {
            if (DOM.checkoutModal && !DOM.checkoutModal.classList.contains('hidden'))
              closeCheckout();
            else if (DOM.productModal && !DOM.productModal.classList.contains('hidden'))
              closeModal();
            else if (DOM.ordersModal && !DOM.ordersModal.classList.contains('hidden'))
              closeOrders();
            else if (DOM.discountModal && !DOM.discountModal.classList.contains('hidden'))
              window.closeDiscountModal();
            else if (DOM.invoiceModal && !DOM.invoiceModal.classList.contains('hidden'))
              window.closeInvoiceModal();
            else closeCart();
          });
        if (DOM.cartToggleBtn) DOM.cartToggleBtn.addEventListener('click', openCart);
        if (DOM.closeCartBtn) DOM.closeCartBtn.addEventListener('click', closeCart);
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            if (DOM.checkoutModal && !DOM.checkoutModal.classList.contains('hidden'))
              closeCheckout();
            else if (DOM.productModal && !DOM.productModal.classList.contains('hidden'))
              closeModal();
            else if (DOM.ordersModal && !DOM.ordersModal.classList.contains('hidden'))
              closeOrders();
            else if (DOM.discountModal && !DOM.discountModal.classList.contains('hidden'))
              window.closeDiscountModal();
            else if (DOM.invoiceModal && !DOM.invoiceModal.classList.contains('hidden'))
              window.closeInvoiceModal();
            else if (DOM.cartSidebar && !DOM.cartSidebar.classList.contains('translate-x-full'))
              closeCart();
          }
        });

        setInterval(updateQRTime, 60000);
        renderMenu();
        refreshCartUI();
        updateQRTime();
      });
    </script>
  </body>
</html>
